
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.79.0">
    <title>Dashboard Template · Bootstrap v5.0</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/dashboard/">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/BrowserFS/2.0.0/browserfs.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>
    

    <!-- Bootstrap core CSS -->
<link href="https://getbootstrap.com/docs/5.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

    <!-- Favicons -->
<link rel="apple-touch-icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
<link rel="manifest" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/manifest.json">
<link rel="mask-icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/safari-pinned-tab.svg" color="#7952b3">
<link rel="icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/favicon.ico">
<meta name="theme-color" content="#7952b3">


    <style>
      /* #mapid { height: 360px; width:360px;} */

      #map {
        height: 400px;
        width: 100%;
       }
      .marginT{
        margin-top: 10px;
      }
      .marginB{
        margin-bottom: 10px;
      }
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      .bottonBlock{
        float: left; text-align: center; margin: 10px 20px;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>

    
    <!-- Custom styles for this template -->
    <link href="dashboard.css" rel="stylesheet">

    <script src="AIBC_ProjectD2.js"></script>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBHivcRvtOHT_Su7y-VMYN-idJCPcURW1w&q&callback=initMap" type="text/javascript"></script>
  </head>
  <body>
    
<header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
  <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="#">Final Project Web</a>
  <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <input class="form-control form-control-dark w-100" type="number" id="inputSearch" placeholder="Please input logno" aria-label="Search" style="margin-right: 20px;">
  <input class="form-control form-control-dark w-100" type="number" id="inputBlocknoSearch" placeholder="Please input blockno" aria-label="Search" style="margin-right: 20px;">  
  <input type="button" value="search" id="btnSearch" class="btn btn-light">
</header>

<div class="container-fluid">
  <div class="row">
    <main class="col-lg-10 px-md-4"> <!-- col-md-9 -->
      <div class="marginT">
        <h1 class="h2">顯示地點</h1>
        <div id="map"></div>     
       
      </div>
      <hr>
     
        <div class="bottonBlock">
              <h1 class="h2">Location上鏈</h1>
              <div class="marginT">
                <label>Logno</label>
                <input id="logno" placeholder="Logno">
                </div>
              <!-- <div class="marginT">
                <label>LogHash</label>
                <input id="loghash" placeholder="LogHash">
              </div>
              <div class="marginT">
                <label>Logname</label>
                <input id="logname" placeholder="Logname">
              </div>
              <div class="marginT">
                <label>Logorg</label>
                <input id="logorg" placeholder="Logorg">
              </div>
              <hr> -->
      
              <!-- <div class="marginT">
                <label>Image url</label>
                <input id="logImageUrl" placeholder="Image url">
              </div>
              <div class="marginT">
                <label>Filehash</label>
                <input id="filehash" placeholder="Filehash">
              </div>
              <hr> -->
         
              <div class="marginT">
                <label>Location</label>
                <input id="title" placeholder="25.123,125.535">
              </div>
              <div class="marginT">
                <label>Begin</label>
                <input id="begin" placeholder="Begin">
              </div>
              <div class="marginT">
                <label>End</label>
                <input id="end" placeholder="End">
              </div>
              <div class="marginT marginB">
                <input type="button" class="btn btn-warning" id="upToChain" value="上鏈">
              </div>
        </div>
        <div class="bottonBlock">
            <h1 class="h2">Image上鏈</h1>
            <div class="marginT">
              <label>Logno</label>
              <input id="lognoI" placeholder="Logno">
              </div>
              <div class="marginT">
                <label>ImageUrl</label>
                <input id="Imageurl" placeholder="https://...">
              </div>
              <div class="marginT">
                <label>FileHash</label>
                <input id="FileHash" placeholder="Begin">
              </div>
              
              <div class="marginT marginB">
                <input type="button" class="btn btn-primary" id="upImageToChain" value="上鏈">
              </div>
          </div>

          <div class="bottonBlock">
            <h1 class="h2">LogUpchain上鏈</h1>
            <div class="marginT">
              <label>Logno</label>
              <input id="lognoL" placeholder="Logno">
              </div>
              <div class="marginT">
                <label>LogHash</label>
                <input id="loghashL" placeholder="LogHash">
              </div>
              <div class="marginT">
                <label>LogName</label>
                <input id="LogName" placeholder="LogName">
              </div>
              <div class="marginT">
                <label>Log Org</label>
                <input id="Logorg" placeholder="Logorg">
              </div>
              <div class="marginT">
                <label>LogDate</label>
                <input id="LogDate" placeholder="LogDate">
              </div>
              
              <div class="marginT marginB">
                <input type="button" class="btn btn-success" id="upLogToChain" value="上鏈">
              </div>
          </div>
          
        </div>
      
    
        
        
       

      

    </main>
  </div>
  <table class="table" id='chainresult'>
    <thead class="table-dark">
      <tr>
        <td>BlockNumber</td>
        <td>Logno</td>
        <td>Image Url</td>
        <td>FileHash</td>
      </tr>
    </thead>
    <tbody>
      <!-- <tr>
        <td>1</td>
        <td>2</td>
        <td>3</td>
      </tr>
      <tr>
        <td>2</td>
        <td>3</td>
        <td>4</td>
      </tr> -->
    </tbody>
  </table>

  <!-- <div id="upToChainResultBlock">
    <table>
      <th>table head</th>
      <tbody>
        <tr>
          <td> table 1</td>
          <td> table 2</td>
        </tr>
        <tr>
          <td> table 3</td>
          <td> table 4</td>
        </tr>
      </tbody>
    </table>
  </div>
</div> -->


    <script src="/docs/5.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>

      <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js" integrity="sha384-zNy6FEbO50N+Cg5wap8IKA4M/ZnLJgzc6w2NqACZaK0u0FXfOWRRJOnQtpZun8ha" crossorigin="anonymous"></script><script src="dashboard.js"></script>
  </body>
</html>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script>
  
  var mymap = L.map('map').setView([25.011472, 121.539917], 13);
    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiY2pjdWppbW15IiwiYSI6ImNramlnOGU5bTFxZHEyeXFwczV4bnhldHUifQ.k4QhrnWNKgJxrzZQoo1bPA', {
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox/streets-v11',
        tileSize: 512,
        zoomOffset: -1,
        accessToken: 'your.mapbox.access.token'
      }).addTo(mymap);

  
  $('#btnSearch').on('click', function(){
  //   var url = '';
  //   var param = {
  //     'logno': $('#inputSearch').val(),
  //     'blockno': $('#inputBlocknoSearch').val()
  // }
  var logno2 = $('#inputSearch').val();
  var blockno2 = $('#inputBlocknoSearch').val();
  // console.log(logno2)
  // console.log(blockno2)
  

  var marker = L.marker([25.011472, 121.539917]).addTo(mymap);

    $.ajax({
        url: 'http://localhost:3000/Search',
        contentType: "application/json; charset=utf-8",
        data:JSON.stringify({logno:logno2,blockno:blockno2}),
        xhrFields: {
                withCredentials: true
            },
        type: 'POST',
        
    }).done((data)=>{
      console.log(data)
      console.log(data[0]['returnValues'][1])
      console.log(typeof(data[0]['returnValues'][1]))
      // console.log(data[0]['returnValues'][1].split(","))
      var gps = data[0]['returnValues'][1].split(",")
      console.log(gps)
      
      var market = L.marker([Number(gps[0]),Number(gps[1])]).addTo(mymap)
    }).fail((error)=>{
      console.log(error)
    })
    // // //取得資料
    // $.ajax({
    //     url: 'localhost:3000/FoodLogSectionUpchain',
    //     type: 'GET',
    //     success: function(resp){
    //       //顯示在畫面上
    //       console.log(resp)
    //       // var respLat = 25.02052822260473;
    //       // var respLng = 121.54922702805244;
    //       // var test = {lat:respLat, lng:respLng};
    //       // var map = new google.maps.Map(document.getElementById('map'), {
    //       //   zoom: 4,
    //       //   center: test
    //       // });
    //       // var marker = new google.maps.Marker({
    //       //   position: test,
    //       //   map: map
    //       // });
    //     },
    //     error: function(resp, exception){
    //       alert(error+exception);
    //     }
    // })
    
  })
  $('#upLogToChain').on('click',()=>{
    var lognoL   = $('#lognoL').val()
    var loghashL = $('#loghashL').val()
    var LogName  = $('#LogName').val()
    var Logorg   = $('#Logorg').val()
    var LogDate  = $('#LogDate').val()

    $.ajax({
        url: 'http://localhost:3000/FoodLogUpchain',
        contentType: "application/json; charset=utf-8",
        data:JSON.stringify({lognoL:lognoL,loghashL:loghashL,LogName:LogName,Logorg:Logorg,LogDate:LogDate}),
        xhrFields: {
                withCredentials: true
            },
        type: 'POST',
        
    }).done((data)=>{
      console.log(data)
      // console.log(data[0]['returnValues'][0])
      // console.log(data[0]['returnValues'][1])
      // console.log(data[0]['returnValues'][2])
      $("#chainresult > tbody").append(`<tr><td>${data[0]['blockNumber']}</td><td>${data[0]['returnValues'][0]}</td><td>${data[0]['returnValues'][1]}</td><td>${data[0]['returnValues'][2]}</td></tr>`);
    }).fail((error)=>{
      console.log(error)
    })
      
    
 
    
  })
  $('#upImageToChain').on('click',()=>{
      var lognoI = $('#lognoI').val()
      var Imageurl = $('#Imageurl').val()
      var FileHash = $('#FileHash').val()
      
    $.ajax({
        url: 'http://localhost:3000/FoodLogImageUpchain',
        contentType: "application/json; charset=utf-8",
        data:JSON.stringify({logno:lognoI,imageurl:Imageurl,filehash:FileHash}),
        xhrFields: {
                withCredentials: true
            },
        type: 'POST',
        
    }).done((data)=>{
      console.log(data)
      // console.log(data[0]['returnValues'][0])
      // console.log(data[0]['returnValues'][1])
      // console.log(data[0]['returnValues'][2])
      $("#chainresult > tbody").append(`<tr><td>${data[0]['blockNumber']}</td><td>${data[0]['returnValues'][0]}</td><td>${data[0]['returnValues'][1]}</td><td>${data[0]['returnValues'][2]}</td></tr>`);
    }).fail((error)=>{
      console.log(error)
    })
      

  })
  $('#upToChain').on('click', function(){
   
    // //取得資料
    // var  longo = $('#logno').val();
    // console.log(longo)
    // var param = {
    var logno1 = $('#logno').val();
    // var loghash1 = $('#loghash').val();
    // var logname1 = $('#logname').val();
    // var logorg1 = $('#logorg').val();
    // var logImageUrl1 = $('#logImageUrl').val();
    // var filehash1 = $('#filehash').val();
    var title1 = $('#title').val();
    var begin1 = $('#begin').val();
    var end1 = $('#end').val();
    // }

    console.log(logno1,title1,begin1,end1)
    
    // console.log('hi')
    // console.log(param)
    $.ajax({
        url: 'http://localhost:3000/FoodLogSectionUpchain',
        data:{logno:logno1,title:title1,loghash:begin1,logname:end1},
        xhrFields: {
                withCredentials: true
            },
        type: 'GET',
        
    }).done((data)=>{
      console.log(data)
      // console.log(data['blockHash'])
      $("#chainresult > tbody").append(`<tr><td>${data[0]['blockNumber']}</td><td>${data[0]['returnValues'][0]}</td><td>${data[0]['returnValues'][1]}</td><td>${data[0]['returnValues'][2]}</td></tr>`);
      
    }).fail((error)=>{
      console.log(error)
    })
    
    // //上鏈
    // var url = '';
   
    // $.ajax({
    //     url: url,
    //     type: 'POST',
    //     data: param,
    //     dataType: 'JSON',
    //     async: true,
    //     cache: false,
    //     success: function(resp){
    //       alert('Upload to chain.');

    //       //可以將回傳資料放至此 #upToChainResultBlock

    //       //先簡單將回傳資訊顯示在畫面上
    //       $('#upToChainResultBlock').text(resp);
    //     },
    //     error: function(resp, exception){
    //       alert(error+exception);
    //     }
    // })


  })

  
</script>